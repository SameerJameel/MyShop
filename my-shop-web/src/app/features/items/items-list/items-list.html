<div class="items-page" dir="rtl">
  <!-- ุนููุงู ุงูุตูุญุฉ -->
  <div class="page-header">
    <div class="page-header__text">
      <h1>ุงูุฃุตูุงู</h1>
      <p class="page-subtitle">
        ุฅุฏุงุฑุฉ ุงูุฃุตูุงูุ ุฃุณุนุงุฑ ุงูุดุฑุงุก ูุงูุจูุนุ ูุญุฏ ุฅุนุงุฏุฉ ุงูุทูุจ.
      </p>
    </div>

    <button class="btn primary" (click)="openAddForm()">
      + ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ
    </button>
  </div>

  <!-- ุฑุณุงุฆู ุญุงูุฉ ุงูุตูุญุฉ -->
  <div class="page-messages">
    <div *ngIf="loading" class="info-box">
      ุฌุงุฑู ุงูุชุญููู...
    </div>

    <div *ngIf="error" class="info-box info-box--error">
      {{ error }}
    </div>
  </div>

  <!-- ุงูููุงุชุฑ -->
  <div class="filters-row" *ngIf="!loading && categories.length">
    <input
      type="text"
      placeholder="ุจุญุซ ุจุงุณู ุงูุตูู ุฃู ุงููุญุฏุฉ..."
      [(ngModel)]="search"
      (input)="applyFilter()" />
  </div>

  <select class="select-items" [(ngModel)]="selectedCategoryId" (change)="applyFilter()">
    <option [ngValue]="0">ูู ุงููุฌููุนุงุช</option>
    <option *ngFor="let c of categories" [ngValue]="c.id">
      {{ c.name }}
    </option>
  </select>

  <!-- ูุธุงู ุงูุชุงุจุงุช -->
  <div class="view-tabs" *ngIf="!loading && filteredItems.length">
    <button 
      class="tab-btn"
      [class.active]="viewMode === 'table'"
      (click)="switchView('table')">
      <span>๐</span> ุนุฑุถ ุฌุฏูู
    </button>
    <button 
      class="tab-btn"
      [class.active]="viewMode === 'cards'"
      (click)="switchView('cards')">
      <span>๐๏ธ</span> ุนุฑุถ ุจุทุงูุงุช
    </button>
  </div>

  <!-- ุนุฑุถ ุงูุฌุฏูู -->
  <div class="card table-card" *ngIf="!loading && filteredItems.length && viewMode === 'table'">
    <div class="table-wrapper">
      <table class="items-table">
        <thead>
          <tr>
            <th>#</th>
            <th>ุงูุงุณู</th>
            <th>ุงููุญุฏุฉ</th>
            <th>ุณุนุฑ ุงูุดุฑุงุก</th>
            <th>ุณุนุฑ ุงูุจูุน</th>
            <th>ุงููุฌููุนุฉ (ID)</th>
            <th>ุญุฏ ุฅุนุงุฏุฉ ุงูุทูุจ</th>
            <th>ุฅุฌุฑุงุกุงุช</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of filteredItems">
            <td>{{ item.id }}</td>
            <td class="col-name">
              <span class="item-name">{{ item.name }}</span>
            </td>
            <td>{{ item.unit }}</td>
            <td>{{ item.defaultPurchasePrice | number: '1.2-2' }}</td>
            <td>{{ item.defaultSalePrice | number: '1.2-2' }}</td>
            <td>{{ item.category?.name }}</td>
            <td>{{ item.reorderLevel }}</td>
            <td class="actions">
              <button class="btn link" (click)="openEditForm(item)">ุชุนุฏูู</button>
              <button class="btn link danger" (click)="deleteItem(item)">ุญุฐู</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ุนุฑุถ ุงููุฑูุช -->
  <div class="cards-grid" *ngIf="!loading && filteredItems.length && viewMode === 'cards'">
    <div class="item-card" *ngFor="let item of filteredItems">
      <div class="item-card-header">
        <h3 class="item-card-title">{{ item.name }}</h3>
        <span class="item-card-id">#{{ item.id }}</span>
      </div>

      <div class="item-card-body">
        <div class="item-info-row">
          <span class="info-label">ุงููุญุฏุฉ:</span>
          <span class="info-value">{{ item.unit }}</span>
        </div>

        <div class="item-info-row">
          <span class="info-label">ุณุนุฑ ุงูุดุฑุงุก:</span>
          <span class="info-value price">{{ item.defaultPurchasePrice | number: '1.2-2' }}</span>
        </div>

        <div class="item-info-row">
          <span class="info-label">ุณุนุฑ ุงูุจูุน:</span>
          <span class="info-value price highlight">{{ item.defaultSalePrice | number: '1.2-2' }}</span>
        </div>

        <div class="item-info-row">
          <span class="info-label">ุงููุฌููุนุฉ:</span>
          <span class="info-value">{{ item.category?.name }}</span>
        </div>

        <div class="item-info-row">
          <span class="info-label">ุญุฏ ุฅุนุงุฏุฉ ุงูุทูุจ:</span>
          <span class="info-value">{{ item.reorderLevel }}</span>
        </div>
      </div>

      <div class="item-card-footer">
        <button class="btn-card" (click)="openEditForm(item)">
          โ๏ธ ุชุนุฏูู
        </button>
        <button class="btn-card btn-card-danger" (click)="deleteItem(item)">
          ๐๏ธ ุญุฐู
        </button>
      </div>
    </div>
  </div>

  <!-- ุญุงูุฉ ูุง ููุฌุฏ ุจูุงูุงุช -->
  <div class="empty-state" *ngIf="!loading && !items.length && !filteredItems.length">
    <div class="card empty-card">
      <p>ูุง ููุฌุฏ ุฃุตูุงู ุจุนุฏ.</p>
      <button class="btn secondary" (click)="openAddForm()">
        + ุฃุถู ุฃูู ุตูู ุงูุขู
      </button>
    </div>
  </div>

  <!-- Popup form -->
  <div class="modal-backdrop" *ngIf="isFormOpen">
    <div class="modal">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'ุชุนุฏูู ุตูู' : 'ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ' }}</h2>
        <button class="close-btn" type="button" (click)="closeForm()">ร</button>
      </div>

      <form [formGroup]="form" (ngSubmit)="submitForm()" class="modal-body">
        <div class="form-row">
          <label>ุงุณู ุงูุตูู</label>
          <input type="text" formControlName="name" />
          <div class="error" *ngIf="f['name'].touched && f['name'].invalid">
            ุงูุงุณู ูุทููุจ
          </div>
        </div>

        <div class="form-row">
          <label>ุงููุญุฏุฉ</label>
          <select formControlName="unit">
            <option value="kg">ูููู</option>
            <option value="piece">ุญุจุฉ</option>
            <option value="carton">ูุฑุชููุฉ</option>
            <option value="pack">ุนุจูุฉ</option>
          </select>
        </div>

        <div class="form-row">
          <label>ุงููุฌููุนุฉ</label>
          <select formControlName="categoryId">
            <option value="0">ุงุฎุชุฑ ูุฌููุนุฉ</option>
            <option *ngFor="let c of categories" [value]="c.id">
              {{ c.name }}
            </option>
          </select>
          <div class="error" *ngIf="f['categoryId'].touched && f['categoryId'].invalid">
            ูุฑุฌู ุงุฎุชูุงุฑ ูุฌููุนุฉ
          </div>
        </div>

        <div class="form-row two-cols">
          <div>
            <label>ุณุนุฑ ุงูุดุฑุงุก</label>
            <input type="number" step="0.01" formControlName="defaultPurchasePrice" />
          </div>
          <div>
            <label>ุณุนุฑ ุงูุจูุน</label>
            <input type="number" step="0.01" formControlName="defaultSalePrice" />
          </div>
        </div>

        <div class="form-row">
          <label>ุญุฏ ุฅุนุงุฏุฉ ุงูุทูุจ</label>
          <input type="number" formControlName="reorderLevel" />
        </div>

        <div class="modal-footer">
          <button type="button" class="btn" (click)="closeForm()">ุฅูุบุงุก</button>
          <button type="submit" class="btn primary">
            {{ isEditMode ? 'ุญูุธ ุงูุชุนุฏููุงุช' : 'ุญูุธ ุงูุตูู' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>