<section class="receive-page" *ngIf="!loading; else loadingTpl">

  <h2>استلام طلبية شراء</h2>

  <form [formGroup]="form">

    <div class="header">
      <div class="field">
        <label>تاريخ الاستلام</label>
        <input type="date" formControlName="receivedDate">
      </div>

      <div class="field">
        <label>خصم</label>
        <input type="number" formControlName="discount">
      </div>

      <div class="field">
        <label>المدفوع</label>
        <input type="number" formControlName="paidAmount">
      </div>
    </div>

    <div class="lines" formArrayName="lines">
      <div class="line-card"
           *ngFor="let ctrl of lines.controls; let i = index"
           [formGroupName]="i">

        <div class="summary">
          <strong>{{ ctrl.get('itemName')?.value }}</strong>
          <span>الكمية: {{ ctrl.get('receivedQty')?.value }}</span>
        </div>

        <div class="details">
          <div class="field">
            <label>المطلوب</label>
            <input type="number" formControlName="orderedQty" >
          </div>

          <div class="field">
            <label>المستلم</label>
            <input type="number" formControlName="receivedQty">
          </div>

          <div class="field">
            <label>سعر الشراء</label>
            <input type="number" formControlName="purchasePrice">
          </div>

          <div class="field">
            <label>سعر البيع</label>
            <input type="number" formControlName="salePrice">
          </div>

          <div class="field wide">
            <label>ملاحظات</label>
            <input type="text" formControlName="notes" placeholder="ملاحظات...">
          </div>
        </div>

        <div class="total">
          {{ lineTotal(ctrl) | currency:'JOD' }}
        </div>

      </div>
    </div>

    <div class="footer">
      <strong>الإجمالي: {{ totalAmount() | currency:'JOD' }}</strong>
      <button type="button" (click)="submit()">تأكيد الاستلام</button>
    </div>

  </form>

</section>

<ng-template #loadingTpl>
  <div class="loading">جارِ التحميل...</div>
</ng-template>
